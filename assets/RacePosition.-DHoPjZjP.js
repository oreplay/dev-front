import{c as I,j as i,r as f,f as C,ax as j,bo as V,J as $,q as v,K as Q,R as P,t as p,bp as G,P as Y,o as K,S as J,U as X,F as Z,aY as ee,V as te,D as b,T,bq as ne,br as se}from"./index-BLfwcZnC.js";import{S as k}from"./Skeleton-DUfcw-PJ.js";import{S as E}from"./Results-ncYOWpnQ.js";import{T as re,F as ie,b as oe,O as le}from"./TextField--dGRmczi.js";import{I as R}from"./InputAdornment-Bjrq8b3k.js";import{C as ae,D as ue,a as ce}from"./index-DDdbeMFW.js";import{c as de}from"./hooks-DJkte6FL.js";import{T as fe,a as F}from"./Tabs-sizw2E99.js";import{T as me}from"./Trans-CRALoKKO.js";import{L as he}from"./Link-BkznJ8DK.js";import{U as y}from"./constants-O1nRK1Hb.js";try{let e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="ae478ace-393e-4152-97ca-5fe8c0c56e8e",e._sentryDebugIdIdentifier="sentry-dbid-ae478ace-393e-4152-97ca-5fe8c0c56e8e")}catch{}const ge=I(i("path",{d:"M4 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m1.13 1.1c-.37-.06-.74-.1-1.13-.1-.99 0-1.93.21-2.78.58C.48 14.9 0 15.62 0 16.43V18h4.5v-1.61c0-.83.23-1.61.63-2.29M20 13c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m4 3.43c0-.81-.48-1.53-1.22-1.85-.85-.37-1.79-.58-2.78-.58-.39 0-.76.04-1.13.1.4.68.63 1.46.63 2.29V18H24zm-7.76-2.78c-1.17-.52-2.61-.9-4.24-.9s-3.07.39-4.24.9C6.68 14.13 6 15.21 6 16.39V18h12v-1.61c0-1.18-.68-2.26-1.76-2.74M8.07 16c.09-.23.13-.39.91-.69.97-.38 1.99-.56 3.02-.56s2.05.18 3.02.56c.77.3.81.46.91.69zM12 8c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m0-2c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"GroupsOutlined"),pe=I(i("path",{d:"M16 11V3H8v6H2v12h20V11zm-6-6h4v14h-4zm-6 6h4v8H4zm16 8h-4v-6h4z"}),"LeaderboardOutlined"),Ce=I(i("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),be=I(i("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");function Se(){return i(k,{variant:"rounded",width:"100%",height:"48px"})}function _e({SkeletonItem:e,style:t,className:s,gap:n,minItems:l}){const o=f.useRef(null),a=f.useRef(null),[r,u]=f.useState(null),[m,d]=f.useState(0);return f.useEffect(()=>{if(!a.current)return;const c=new ResizeObserver(([h])=>{h.contentRect.height>0&&u(h.contentRect.height)});return c.observe(a.current),()=>{c.disconnect()}},[]),f.useEffect(()=>{if(r&&o.current){const c=o.current.clientHeight;let h=Math.floor(c/r);l&&h<Math.floor(l)&&(h=l),d(h)}},[l,r]),C(E,{ref:o,style:{height:"100%",width:"100%",overflow:"hidden",...t},className:s,direction:"column",gap:n,children:[!r&&i("div",{ref:a,style:{visibility:"hidden",position:"absolute"},children:i(e,{})}),r&&Array.from({length:m}).map((c,h)=>i(e,{},h))]})}function ve({children:e,isLoading:t}){return t?i(_e,{SkeletonItem:Se,gap:"8px"}):i(j,{sx:{padding:0,flexGrow:1},children:e})}function ye({name:e,onClick:t}){return i(V,{onClick:t,children:i($,{children:e})})}function xe({value:e,setValue:t}){const{t:s}=v();return i(re,{placeholder:s("Search.Search"),variant:"standard",value:e,onChange:n=>t(n.target.value),sx:{marginY:2,width:"100%"},slotProps:{input:{sx:{mx:"10px",mt:"5px"},endAdornment:e?i(R,{position:"end",children:i(Q,{title:s("Search.ClearSearch"),children:i(P,{size:"small",onClick:()=>t(""),"aria-label":s("Clear search"),children:i(ae,{})})})}):i(R,{position:"start",children:i(be,{})})}}})}function N({itemList:e,nameExtractor:t,keyExtractor:s,handleClick:n,normalizeQuery:l,isLoading:o}){const[a,r]=f.useState(""),u=f.useMemo(()=>l?d=>l(d).toLowerCase():d=>d.toLowerCase(),[l]),m=f.useMemo(()=>{const d=u(a);return e.filter(c=>u(t(c)).includes(d))},[e,a,t,u]);return C(p,{sx:{padding:0,width:"100%",height:"100%"},children:[i(xe,{value:a,setValue:r}),i(ve,{isLoading:o,children:m.map(d=>i(ye,{name:t(d),onClick:()=>n(d)},s(d)))})]})}const we=e=>e.replace(/-/g,""),Ie=e=>e.toLowerCase().replace(/[-_]/g,"");function M(e){const{children:t,value:s,index:n,...l}=e;return i(p,{role:"tabpanel",hidden:s!==n,id:`simple-tabpanel-${n}`,"aria-labelledby":`simple-tab-${n}`,...l,sx:{height:"100%"},children:s===n&&i(p,{sx:{height:"100%"},children:t})})}function Le(e){var d;const{t}=v(),[s,n]=f.useState(!1),[l,o]=f.useState(0),{getClassClubSearchParamName:a}=de(),r=f.useRef(!1);f.useEffect(()=>{if(r.current)return;const[c,h]=a();r.current=!0,c!==null&&h!==null?o(h?0:1):n(!0)},[a]);const u=c=>{e.setActiveClassClubId(c.id,!0),n(!1)},m=c=>{e.setActiveClassClubId(c.id,!1),n(!1)};return C(p,{children:[C(ie,{sx:{maxWidth:300,cursor:"pointer"},onClick:()=>n(!0),children:[i(oe,{shrink:!!e.activeClassClub,children:e.isClass?t("ResultsStage.Class"):t("ResultsStage.Club")}),i(le,{readOnly:!0,notched:!!e.activeClassClub,value:((d=e.activeClassClub)==null?void 0:d.short_name)||"",endAdornment:i(R,{position:"end",children:i(G,{})}),label:e.isClass?t("ResultsStage.Class"):t("ResultsStage.Club"),sx:{pointerEvents:"none"},inputProps:{tabIndex:-1}})]}),i(ue,{open:s,onClose:()=>n(!1),maxWidth:"xs",sx:{"& .MuiDialog-paper":{height:"90%",maxHeight:"none"}},fullWidth:!0,children:C(ce,{sx:{height:"100%"},children:[C(p,{sx:{display:"inline-flex",justifyContent:"space-between",width:"100px",boxSizing:"border-box"},children:[i(p,{sx:{flexShrink:1,flexGrow:1},children:C(fe,{variant:"scrollable",scrollButtons:"auto",value:l,onChange:(c,h)=>o(h),children:[i(F,{label:t("ResultsStage.Classes"),icon:i(pe,{}),iconPosition:"start"}),i(F,{label:t("ResultsStage.Clubs"),icon:i(ge,{}),iconPosition:"start"})]})}),i(p,{children:i(P,{"aria-label":"close",onClick:()=>n(!1),sx:{position:"absolute",right:8,top:8,color:c=>c.palette.grey[500]},children:i(Y,{})})})]}),i(M,{value:l,index:0,children:i(N,{itemList:e.classesQuery.data?e.classesQuery.data.data:[],nameExtractor:c=>c.short_name,keyExtractor:c=>c.id,handleClick:u,normalizeQuery:we,isLoading:e.classesQuery.isLoading||e.classesQuery.isFetching})}),i(M,{value:l,index:1,children:i(N,{itemList:e.clubsQuery.data?e.clubsQuery.data.data:[],nameExtractor:c=>c.short_name,keyExtractor:c=>c.id,handleClick:m,normalizeQuery:Ie,isLoading:e.clubsQuery.isLoading||e.clubsQuery.isFetching})})]})})]})}function Te(){const{t:e}=v(),t=K();return i(p,{sx:{marginBottom:"2em"},children:C(J,{severity:"warning",children:[i(X,{children:e("ResultsStage.WrongFileUploaded.Title")}),C(me,{i18nKey:"ResultsStage.WrongFileUploaded.Msg",children:["First part"," ",i(he,{onClick:()=>{t("/organizers")},children:"organizers"})," ","Second part"]})]})})}function at(e){const{t}=v();return C(p,{sx:{height:"calc(100% - 64px)",padding:"24px 24px",display:"flex",flexDirection:"column",minHeight:0},children:[e.isWrongFileUploaded?i(Te,{}):i(Z,{}),C(p,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",maxWidth:"600px"},children:[i(Le,{activeClassClub:e.activeItem,isClass:e.isClass,setActiveClassClubId:e.setActiveClassClub,classesQuery:e.classesQuery,clubsQuery:e.clubsQuery}),i(Q,{title:t("ResultsStage.Refresh"),children:i(P,{onClick:e.handleRefreshClick,children:i(Ce,{})})})]}),i(p,{sx:{marginTop:"12px",flex:1,paddingBottom:"56px"},children:i(ee,{fallback:i(te,{displayMsg:!0}),children:e.children})})]})}const g={ok:"0",dns:"1",dnf:"2",mp:"3",dsq:"4",ot:"5",nc:"9"},S={ok:"ok",dns:"dns",dnf:"dnf",mp:"mp",dsq:"dsq",ot:"ot",nc:"nc"};function L(e){let t;switch(ke(e)?t=e.stage.upload_type:t=e.upload_type,t){case y.START_TIMES:return!1;case y.ONLINE_SPLITS:return!1;case y.SPLIT_RESULT:return!0;case y.FINAL_RESULT:return!0;default:throw new Error(`Unknown upload_type ${t}`)}}function ke(e){return"stage"in e}function x(e){return e.stage.status_code===g.nc||e.is_nc}const Re=(e,t)=>{const s=t("ResultsStage.NoClubMsg");return e.club?e.club.short_name:s},Pe=(e,t)=>{var s,n;return(((s=e==null?void 0:e.stage)==null?void 0:s.leg_number)||0)-(((n=t==null?void 0:t.stage)==null?void 0:n.leg_number)||0)},Ee=e=>e.class.short_name,Oe=e=>e.stage.status_code===g.dns,Ae=e=>x(e),w={getClubName:Re,getClassName:Ee,compareLegNumber:Pe,isDNS:Oe,isNC:Ae};function z(e,t){switch(e){case g.ok:return t==0?2:0;case g.ot:return 1;case g.mp:return 3;case g.nc:return 0;case g.dnf:return 4;case g.dsq:return 5;case g.dns:return 6;default:return 10}}function Fe(e,t,s,n){const l=z(e,s),o=z(t,n);return l!==void 0&&o!==void 0?l-o:l?-1:1}function Ne(e,t){var a,r,u,m;const s=(a=e.stage)==null?void 0:a.status_code,n=(r=t.stage)==null?void 0:r.status_code,l=(u=e.stage)==null?void 0:u.position,o=(m=t.stage)==null?void 0:m.position;return Fe(s,n,l,o)}function U(e,t,s,n){return e&&t?e===t?_.byIsNC(s,n):e-t:e?-1:t?1:0}function Me(e,t){var l,o;const s=(l=e.stage)==null?void 0:l.position,n=(o=t.stage)==null?void 0:o.position;return s!==0&&n!==0?U(s,n,w.isNC(e),w.isNC(t)):s===0&&n===0?0:s===0?1:n===0?-1:0}function ze(e,t){var l,o;const s=(l=e.overalls)==null?void 0:l.overall.position,n=(o=t.overalls)==null?void 0:o.overall.position;return U(s,n,w.isNC(e),w.isNC(t))}function De(e,t){const s=e.full_name.toLowerCase(),n=t.full_name.toLowerCase();return s.localeCompare(n)}function Be(e,t,s=!0){var o,a;const n=(o=e.stage)==null?void 0:o.start_time,l=(a=t.stage)==null?void 0:a.start_time;return n&&l?s?n.localeCompare(l):l.localeCompare(n):n?-1:l?1:0}function Qe(e,t){return e&&t?0:e?1:t?-1:0}const _={byStagePosition:Me,byStageStatus:Ne,byOverallPosition:ze,byName:De,byStartTime:Be,byIsNC:Qe};function ut(e){switch(e){case g.ok:return S.ok;case g.dns:return S.dns;case g.dnf:return S.dnf;case g.mp:return S.mp;case g.dsq:return S.dsq;case g.ot:return S.ot;case g.nc:return S.nc;default:return"unknown"+e}}function Ue(e,t,s){let n=0;for(let l=0;l<s.length&&n==0;++l)n=s[l](e,t);return n}function ct(e){return e.sort((t,s)=>Ue(t,s,[_.byStageStatus,_.byStagePosition,_.byOverallPosition,(n,l)=>_.byStartTime(n,l,!1),_.byName]))}f.createContext(null);f.createContext([[],!1]);const He=f.createContext(b.now());function We({children:e}){const[t,s]=f.useState(b.now());return f.useEffect(()=>{const n=setInterval(()=>{s(b.now())},1e3);return()=>clearInterval(n)},[]),i(He.Provider,{value:t,children:e})}const dt=({children:e})=>i(We,{children:i(p,{sx:{height:"100%",marginBottom:"2rem",maxWidth:"600px",width:"100%"},children:i(E,{direction:"column",spacing:2,sx:{flexWrap:"wrap"},children:e})})});function qe(){return C(p,{sx:{display:"flex",flexDirection:"column",justifyContents:"space-between",maxWidth:600,width:"100%",gap:"5px",borderBottom:"1px solid #f2f2f2",paddingY:".8em"},children:[i(k,{sx:{bgcolor:"gray.10"},variant:"rounded",height:24,width:"100%",animation:"wave"}),i(k,{sx:{bgcolor:"gray.10"},variant:"rounded",height:20,width:"100%",animation:"wave"})]})}function ft(){const e=f.useRef(null),[t,s]=f.useState(0);return f.useEffect(()=>{const n=()=>{if(e.current){const l=e.current.clientHeight,a=Math.floor(l/75);s(a)}};return n(),window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}},[]),i(E,{ref:e,style:{height:"100%",overflow:"hidden"},direction:"column",gap:0,children:Array.from({length:t}).map((n,l)=>i(qe,{},l))})}function mt(){const{t:e}=v();return i(p,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"70%"},children:i(T,{sx:{fontSize:"20px"},children:e("ResultsStage.ChooseClass")})})}function je(e){let t=[];for(let s=0;s<e.length;s++){const l=e[s].stage.splits;if(l)try{t=Ve(l);break}catch(o){console.error(o)}}return t}function Ve(e){return[...e].map(s=>({control:s.control,order_number:s.order_number}))}function ht(e){const t=[...e];return t.push({station:"Finish",id:"FinishOlineControl"}),t}function $e(e,t,s){const n=t.map(r=>r.station),o=e.filter(r=>r.control?n.includes(r.control.station):!0).map(r=>({...r,is_next:null}));let a=s;for(let r=0;r<o.length;r++){const u=o[r];if(u.reading_time===null&&a!==null){u.is_next=b.fromISO(a);break}else a=u.reading_time}return o}function Ge(e){return{...e,time:null,time_behind:null,position:null,cumulative_time:null,cumulative_behind:null,cumulative_position:null}}function Ye(e,t,s,n,l){const o=s?b.fromISO(s):null,a=e.map((r,u,m)=>{if(t&&r.reading_time){const d=b.fromISO(r.reading_time);if(r.cumulative_time=d.diff(t).as("seconds"),u==0)r.time=r.cumulative_time;else{const c=m[u-1].reading_time;c&&(r.time=d.diff(b.fromISO(c)).as("seconds"))}}return r});if(e.length>0&&t){const r=e.at(-1).reading_time;a.push({id:`${n}-finishSplit`,reading_time:s,order_number:1/0,points:0,time:r&&o?o.diff(b.fromISO(r)).as("seconds"):null,time_behind:null,position:null,cumulative_time:r&&o?l:null,cumulative_behind:null,cumulative_position:null,control:null,is_intermediate:!0})}return a}function Ke(e,t){return e.order_number&&t.order_number?e.order_number-t.order_number:!e.order_number&&!t.order_number?0:e.order_number?1:-1}function D(e,t){const s=e.stage;if(s){let n=s.splits.map(Ge);n.sort(Ke);const l=s.start_time?b.fromISO(s.start_time):null;n=Ye(n,l,s.finish_time,e.id,s.time_seconds);const o=e.class&&t?t.find(m=>{var d;return m.id===((d=e.class)==null?void 0:d.id)}):null,a=o?o.splits:null,r=a?$e(n,a,s.start_time):[],u={...s,splits:n,online_splits:r};return{...e,stage:u}}else return e}function gt(e,t){return e.map(s=>{const n=D(s);if(n.runners){const l={...n,runners:n.runners.map(o=>D(o,t))};return l.runners.sort((o,a)=>o.leg_number-a.leg_number),l}else return n})}function pt(e,t=!0){if(e.length>0){const s=je(e),n=s.map((o,a)=>e.map(r=>r.stage.splits[a]&&L(r)?x(r)&&t?null:r.stage.splits[a].time:null));n.forEach(o=>{o.sort((a,r)=>a===null&&r===null?0:a===null?1:r===null?-1:a-r)});const l=s.map((o,a)=>e.map(r=>{const u=r.stage.splits.findIndex(m=>m.time===null);return r.stage.splits[a]&&L(r)&&(u===-1||u>a)?x(r)&&t?null:r.stage.splits[a].cumulative_time:null}));return l.forEach(o=>{o.sort((a,r)=>a===null&&r===null?0:a===null?1:r===null?-1:a-r)}),e.map(o=>{if(L(o))try{const a=x(o),r=o.stage.splits.map((u,m,d)=>{const c=n[m][0],h=l[m][0];if(c!==null&&h!==null){const O=d.findIndex(q=>q.time===null),H=B(n,u.time,m,a,t),W=B(l,u.cumulative_time,m,a,t),A=u.cumulative_time!==null&&(O===-1||O>m);return{...u,time_behind:u.time!==null?u.time-c:null,position:u.time!==null?H:null,cumulative_behind:A&&u.cumulative_time?u.cumulative_time-h:null,cumulative_position:A?W:null}}else return u});return{...o,stage:{...o.stage,splits:r}}}catch(a){return ne(r=>{r.setExtra("runner",o),r.setExtra("runnerList",e),r.setExtra("origin","calculatePositionsAndBehindsFootO"),se(a)}),console.error(`Error updating runner in \`calculatePositionsAndBehindsFootO\`. Runner ${o.id}, ${o.full_name} could not be updated.

`,a),o}else return o})}else return[]}function B(e,t,s,n,l){if(t===null)return null;if(n&&l){const o=e[s];let a=o.length;for(let r=0;r<o.length;r++){const u=o[r];if(u&&t<=u){a=r+1;break}}return a}else return e[s].indexOf(t)+1}function Ct({position:e,isNC:t,hasDownload:s}){const{t:n}=v();if(t)return i(T,{sx:{color:"primary.main"},children:n("ResultsStage.statusCodes.nc")});{const l=s?"primary.main":"text.secondary",o=e?`${e}.`:"";return i(T,{sx:{color:l},children:o})}}export{mt as C,_e as L,He as N,ft as R,at as S,dt as a,w as b,gt as c,pt as d,Ct as e,S as f,$e as g,L as h,ht as i,je as j,We as k,x as l,Ue as m,g as n,ut as p,_ as r,ct as s};
//# sourceMappingURL=RacePosition.-DHoPjZjP.js.map
