import{D as H,b as ce,S as de,E as ue,a as he}from"./ApiErrorService-CYz9grQF.js";import{f as ge,u as me,G as A,D as ve,a as fe,A as ee}from"./DataGrid-ByNRxMpl.js";import{g as pe,a as be,r as C,b as Ce,j as e,s as ye,h as Te,k as Ee,T as x,H as Se,c as R,_ as Y,I as q,f as g,L as P,F as S,J as te,p as E,q as D,K as k,M as De,w as $,x as N,o as ne,P as ke,t as M,Q as we,R as G,D as I,v as Ie,G as Ae,S as xe,U as Me,V as Re}from"./index-Bq7_3jVk.js";import{M as z,d as Oe,a as Fe,w as $e,b as Ne,c as Le,e as _e,i as Be,f as Ge,h as He,j as Pe}from"./EventAdminService-BAaJqk_Y.js";import{S as O,u as ze}from"./constants-BPAhJvPF.js";import{A as je}from"./ArrowForward-BhXq1qdF.js";import{D as j,a as U}from"./index-BYXtU0FR.js";import{D as V}from"./DialogTitle-CVjJVph4.js";import{M as Ue,T as Q}from"./TextField-DbqBfEi2.js";import{C as oe}from"./Container-qbtm8_yy.js";import{G as _}from"./Grid-DlEM3KUo.js";import Ve from"./NotFoundPage-DMYmWl89.js";import"./index-CPWYCp69.js";import"./InputAdornment-DHvK-2H8.js";import"./FormControlLabel-CGHOSUR7.js";import"./Checkbox-CIfKUzV5.js";import"./KeyboardArrowRight-Dc8ymk_B.js";import"./LastPage-c7fM9VJs.js";import"./TableCell-CG6V_PCr.js";import"./Skeleton-Bp6dYDR5.js";import"./useQuery-C7k-JlZw.js";import"./EventService-Qd93CJkn.js";import"./styled-DO6CDtHy.js";try{let n=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new n.Error().stack;t&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[t]="60e0a934-b682-455d-99a8-ed2c8eae4d37",n._sentryDebugIdIdentifier="sentry-dbid-60e0a934-b682-455d-99a8-ed2c8eae4d37")}catch{}function We(n){return pe("MuiDialogContentText",n)}be("MuiDialogContentText",["root"]);const Ye=n=>{const{classes:t}=n,o=Ee({root:["root"]},We,t);return{...t,...o}},qe=ye(x,{shouldForwardProp:n=>Se(n)||n==="classes",name:"MuiDialogContentText",slot:"Root",overridesResolver:(n,t)=>t.root})({}),W=C.forwardRef(function(t,a){const o=Ce({props:t,name:"MuiDialogContentText"}),{children:d,className:u,...s}=o,r=Ye(s);return e(qe,{component:"p",variant:"body1",color:"textSecondary",ref:a,ownerState:s,className:Te(r.root,u),...o,classes:r})}),Qe=R(e("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6m6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26"}),"Autorenew"),Je=R(e("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy"),ae=R(e("path",{d:"M16 9v10H8V9zm-1.5-6h-5l-1 1H5v2h14V4h-3.5zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2z"}),"DeleteOutlined"),Ke=R(e("path",{d:"M8.65 5.82C9.36 4.72 10.6 4 12 4c2.21 0 4 1.79 4 4 0 1.4-.72 2.64-1.82 3.35zM20 17.17c-.02-1.1-.63-2.11-1.61-2.62-.54-.28-1.13-.54-1.77-.76zm1.19 4.02L2.81 2.81 1.39 4.22l8.89 8.89c-1.81.23-3.39.79-4.67 1.45-1 .51-1.61 1.54-1.61 2.66V20h13.17l2.61 2.61z"}),"PersonOff"),Xe=R(e("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings"),Ze=["label","icon","showInMenu","onClick"],et=["label","icon","showInMenu","onClick","closeMenuOnClick","closeMenu"],F=ge((n,t)=>{var h;const a=me();if(!n.showInMenu){const{label:p,icon:v,onClick:b}=n,w=Y(n,Ze),T=y=>{b==null||b(y)};return e(a.slots.baseIconButton,q({size:"small",role:"menuitem","aria-label":p},w,{onClick:T},(h=a.slotProps)==null?void 0:h.baseIconButton,{ref:t,children:C.cloneElement(v,{fontSize:"small"})}))}const{label:o,icon:d,onClick:u,closeMenuOnClick:s=!0,closeMenu:r}=n,c=Y(n,et);return g(z,q({ref:t},c,{onClick:p=>{u==null||u(p),s&&(r==null||r())},children:[d&&e(P,{children:d}),o]}))}),tt=[{value:O.FootO,label:"FootO"},{value:O.Rogaine,label:"Rogaine"},{value:O.Relay,label:"Relay"},{value:O.Totals,label:"Totals"}];function J(n){const[t,a]=C.useState(!1),o=C.useCallback(()=>{a(!1)},[]),d=C.useCallback(()=>{a(!0)},[]);return g(S,{children:[g(z,{onClick:d,children:[e(P,{children:n.icon}),e(te,{children:n.menuText})]}),g(j,{open:t,children:[e(V,{id:"alert-dialog-title",children:n.dialogTitle}),e(U,{children:e(W,{id:"alert-dialog-description",children:n.dialogBody})}),g(H,{children:[e(E,{variant:"outlined",onClick:()=>{o(),n.menuCloseAction()},children:n.dialogCancelButtonText}),e(E,{variant:"contained",onClick:()=>{n.action(),o()},color:"error",autoFocus:!0,children:n.dialogConfirmButtonText})]})]})]})}const nt=({handleDeleteClick:n,handleEditClick:t,handleWipeOutRunnersClick:a})=>{const{t:o}=D(),[d,u]=C.useState(null),s=!!d,r=l=>{u(l.currentTarget)},c=()=>{u(null)};return g(S,{children:[e(k,{title:o("Settings"),children:e(F,{icon:e(Xe,{}),label:"Settings",className:"textPrimary",color:"inherit",onClick:r})}),g(Ue,{id:"options",anchorEl:d,open:s,onClose:c,children:[g(z,{onClick:t,children:[e(P,{children:e(ce,{})}),e(te,{children:o("Edit")})]}),e(De,{}),e(J,{icon:e(Ke,{}),menuText:o("EventAdmin.Stages.WipeOutRunners.MenuText"),action:()=>{c(),a()},menuCloseAction:c,dialogTitle:o("EventAdmin.Stages.WipeOutRunners.DialogTitle"),dialogBody:o("EventAdmin.Stages.WipeOutRunners.DialogBody"),dialogCancelButtonText:o("Cancel"),dialogConfirmButtonText:o("EventAdmin.Stages.WipeOutRunners.DialogConfirm")}),e(J,{icon:e(ae,{}),menuText:o("EventAdmin.Stages.DeleteStage.MenuText"),action:()=>{n(),c()},menuCloseAction:c,dialogTitle:o("EventAdmin.Stages.DeleteStage.DialogTitle"),dialogBody:o("EventAdmin.Stages.DeleteStage.DialogBody"),dialogCancelButtonText:o("Cancel"),dialogConfirmButtonText:o("Delete")})]})]})},K="officialSub20",X="officialSenior",ot="others",at=["M","F"];function Z(n){return Object.keys(n).filter(t=>at.includes(t))}function it(n){const t={table1:{},table2:{}},a=["1 Inscritos totales","2 Inscritos totales cat. <SUB-20","3 Inscritos totales cat. >SUB-20","4 No salen","5 Error en tarjeta","6 Abandonan","7 Fuera de control","8 Descalificados"],o=["1 Inscritos totales","2 No salen","3 Error en tarjeta","4 Abandonan","5 Fuera de control","6 Descalificados"],d=l=>Object.fromEntries(l.map(h=>[h,{M:0,F:0,total:0}]));t.table1=d(a),t.table2=d(o);const u=[K,X];for(const l of u){const h=n[l],p=Z(h);for(const v of p){const b=h[v];t.table1[a[0]][v]+=b.total,l===K?t.table1[a[1]][v]+=b.total:l===X&&(t.table1[a[2]][v]+=b.total),t.table1[a[3]][v]+=b.dns,t.table1[a[4]][v]+=b.mp,t.table1[a[5]][v]+=b.dnf,t.table1[a[6]][v]+=b.ot,t.table1[a[7]][v]+=b.dqf}}const s=n[ot],r=Z(s);for(const l of r){const h=s[l];t.table2[o[0]][l]+=h.total,t.table2[o[1]][l]+=h.dns,t.table2[o[2]][l]+=h.mp,t.table2[o[3]][l]+=h.dnf,t.table2[o[4]][l]+=h.ot,t.table2[o[5]][l]+=h.dqf}const c=l=>{for(const h of Object.keys(l))l[h].total=l[h].M+l[h].F};return c(t.table1),c(t.table2),t}function st(n){const o=(u,s)=>{let r=`; ${u} ; M ; F ; Total ;
`;r+=`;-----------;---;---;-------;
`;for(const[c,l]of Object.entries(s))r+=`; ${c} ; ${l.M} ; ${l.F} ; ${l.total} ;
`;return r+=`
`,r};let d="";return d+=o("OFICIAL",n.table1),d+=o("NO OFICIAL",n.table2),d}function lt(n){const t=d=>d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),a=(d,u)=>{let s=`<table border="1"><tbody><tr><td> ${d} </td><td> M </td><td> F </td><td> Total </td></tr>`;for(const[r,c]of Object.entries(u))s+=`<tr><td> ${t(r)} </td><td> ${c.M} </td><td> ${c.F} </td><td> ${c.total} </td></tr>`;return s+="</tbody></table></br>",s};let o="";return o+=a("OFICIAL",n.table1),o+=a("NO OFICIAL",n.table2),o}const B={processData:it,formatAsTxtTables:st,formatAsHtmlTables:lt};function rt(n){const{t}=D(),{setRows:a,setRowModesModel:o}=n;return e(we,{children:e(E,{color:"primary",startIcon:e(ee,{}),onClick:()=>{const u=`new-${Math.random().toString(36).substring(2,9)}`;a(s=>[...s,{id:u,stageName:"",isNew:!0,isEdit:!1}]),o(s=>({...s,[u]:{mode:A.Edit,fieldToFocus:"name"}}))},children:t("EventAdmin.Stages.NewStage")})})}function ct(n){const{t}=D(),{token:a}=$(),o=N(),d=ne(),u=n.eventDetail.stages.map(i=>({id:i.id,stageId:i.id,stageName:i.description,stageTypeId:i.stage_type.id})),[s,r]=C.useState(u),[c,l]=C.useState({}),h=(i,f)=>{i.reason===fe.rowFocusOut&&(f.defaultMuiPrevented=!0)},p=i=>{l({...c,[i.id]:{mode:A.Edit}})},v=i=>()=>{l({...c,[i.id]:{mode:A.View}})},b=async i=>{await Oe(n.eventDetail.id,i.row.stageId,a).then(()=>r(s.filter(f=>f.id!==i.id)))},w=async i=>{try{const f=await Fe(n.eventDetail.id,i.row.stageId),m=B.processData(f.data),le=B.formatAsTxtTables(m),re=B.formatAsHtmlTables(m);await navigator.clipboard.writeText(le),o.show(e("span",{dangerouslySetInnerHTML:{__html:t("Copied to the clipboard")+"</br>"+re}}),{autoHideDuration:15e3,severity:"success"})}catch{o.show("Error",{autoHideDuration:3e3,severity:"error"})}},T=async i=>{try{const f=o.show(t("Loading"),{autoHideDuration:3e4,severity:"info"});await $e(n.eventDetail.id,i.row.stageId,a).then(()=>{}),o.close(f),o.show(t("Success"),{autoHideDuration:3e3,severity:"success"})}catch{o.show("An error occurred resetting the event.",{autoHideDuration:3e3,severity:"error"})}},y=i=>()=>{l({...c,[i.id]:{mode:A.View,ignoreModifications:!0}}),s.find(m=>m.id===i.id).isNew&&r(s.filter(m=>m.id!==i.id))},L=async i=>{const f={...i,isEdit:!1,isNew:!1};if(i.isNew)try{const m=await Ne(n.eventDetail.id,i.stageName,i.stageTypeId,a);f.id=m.data.id,f.stageId=m.data.id}catch(m){console.error("Something bad happened while posting the stage: ",m)}else try{await Le(n.eventDetail.id,i.stageId,i.stageName,i.stageTypeId,a)}catch(m){console.error("Something bad happened while updating the stage: ",m)}return console.log(s),r(s.map(m=>m.id===i.id||m.id=="newlyCreatedStage"?f:m)),f},ie=i=>{l(i)},se=[{field:"stageName",headerName:t("Name"),flex:1,type:"string",align:"left",headerAlign:"left",editable:!0},{field:"stageTypeId",headerName:t("EventAdmin.Stages.StagesTypes.StageType"),width:150,type:"singleSelect",valueOptions:tt.map(i=>{const f=t(`EventAdmin.Stages.StagesTypes.${i.label}`);return{value:i.value,label:f}}),align:"left",headerAlign:"left",editable:!0},{field:"actions",type:"actions",headerName:"",width:100,cellClassName:"actions",getActions:i=>{var m;return((m=c[i.id])==null?void 0:m.mode)===A.Edit?[e(k,{title:t("Save"),children:e(F,{icon:e(de,{}),label:"Save",sx:{color:"primary.main"},onClick:v(i)})}),e(k,{title:t("Cancel"),children:e(F,{icon:e(ke,{}),label:"Cancel",className:"textPrimary",onClick:y(i),color:"inherit"})})]:[e(nt,{handleEditClick:()=>p(i),handleDeleteClick:()=>void b(i),handleStatsClick:()=>void w(i),handleWipeOutRunnersClick:()=>void T(i)}),e(k,{title:t("EventAdmin.Stages.GoToStage"),children:e(F,{icon:e(je,{}),label:"View",className:"textPrimary",color:"inherit",onClick:()=>{d(`/competitions/${n.eventDetail.id}/${i.row.stageId}`)}})})]}}];return e(M,{sx:{minHeight:200,maxHeight:500,width:"100%","& .actions":{color:"text.secondary"},"& .textPrimary":{color:"text.primary"}},children:e(ve,{rows:s,columns:se,editMode:"row",rowModesModel:c,onRowModesModelChange:ie,onRowEditStop:h,processRowUpdate:L,slots:{toolbar:rt},slotProps:{toolbar:{setRows:r,setRowModesModel:l}}})})}function dt(n){const{t}=D(),a=N(),o=()=>{navigator.clipboard.writeText(n.value),a.show(t("Copied to the clipboard"),{autoHideDuration:5e3,severity:"success"})};return e(S,{children:e(k,{title:t("Copy"),children:e(G,{onClick:o,children:e(Je,{})})})})}function ut(n){const{t}=D(),[a,o]=C.useState(!1),d=()=>{o(!1)},u=()=>{n.handleRenewToken(),o(!1)};return g(S,{children:[n.eventToken==""?e(G,{children:e(k,{title:t("EventAdmin.Create security keys"),children:e(ee,{onClick:()=>n.handleRenewToken()})})}):g(S,{children:[e(G,{children:e(k,{title:t("EventAdmin.Renew security keys"),children:e(Qe,{onClick:()=>o(!0)})})}),e(dt,{value:`${n.eventId}${n.eventToken}`})]}),g(j,{open:a,onClose:d,children:[e(V,{id:"alert-dialog-title",children:t("EventAdmin.Do you want to renew the security key?")}),e(U,{children:e(W,{id:"alert-dialog-description",children:t("EventAdmin.RenewEventTokenMsg")})}),g(H,{children:[e(E,{variant:"outlined",onClick:d,children:t("Cancel")}),e(E,{variant:"contained",onClick:u,autoFocus:!0,children:t("EventAdmin.Renew")})]})]})]})}function ht(n){const{token:t}=$(),{t:a}=D(),[o,d]=C.useState(""),[u,s]=C.useState(null),[r,c]=C.useState(!0);C.useEffect(()=>{_e(n.event_id,t).then(v=>(v.data.length>0&&(d(v.data[0].token),s(I.fromISO(v.data[0].expires))),c(!1),()=>c(!0)))},[]);const l=()=>{h()},h=async()=>{if(c(!0),o!="")try{await Be(n.event_id,o,t)}catch(p){console.log("Error in invalidateEventToken",p),c(!1)}try{const p=await Ge(n.event_id,t);d(p.data.token),s(I.fromISO(p.data.expires)),c(!1)}catch(p){console.log("error in postEventToken",p),c(!1)}};return e(oe,{component:"form",disableGutters:!0,children:g(_,{container:!0,spacing:2,sx:{marginY:"2em"},children:[e(_,{item:!0,xs:12,md:8,children:e(Q,{fullWidth:!0,id:"securityToken",name:"securityToken",label:a("EventAdmin.EventSecurityTokens"),value:r?a("Loading"):o?`${n.event_id}${o}`:"",disabled:!0,InputProps:{endAdornment:e(ut,{eventToken:o||"",handleRenewToken:l,eventId:n.event_id})}})}),e(_,{item:!0,xs:12,md:4,children:e(Q,{fullWidth:!0,id:"tokenExpiracyDate",name:"token expiry date",error:u?u<I.now():!1,disabled:!0,label:a("EventAdmin.EventSecurityTokensExpireDate"),value:r?a("Loading"):u?u.toLocaleString(I.DATE_SHORT):""})})]})})}function gt(n){const[t,a]=C.useState(!1),{t:o}=D(),d=ne(),{token:u}=$(),s=N(),r=()=>{a(!1)},c=async()=>{try{await He(n.event.id,u),await d("/dashboard")}catch(l){s.show("An error occurred deleting the event.",{autoHideDuration:3e3,severity:"error"}),console.log("error in deleting the event ",l)}};return g(S,{children:[e(E,{variant:"outlined",color:"error",startIcon:e(ae,{}),onClick:()=>a(!0),children:o("EventAdmin.DeleteEvent")}),g(j,{open:t,onClose:r,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e(V,{id:"alert-dialog-title",children:o("EventAdmin.Do you want to delete this event?")}),e(U,{children:e(W,{id:"alert-dialog-description",children:o("This action cannot be undone")})}),g(H,{children:[e(E,{variant:"outlined",onClick:r,children:o("Cancel")}),e(E,{variant:"contained",onClick:()=>void c(),color:"error",autoFocus:!0,children:o("Delete")})]})]})]})}function mt(){return Ie()}function Bt(){var w;const n=N(),{eventId:t}=mt(),{data:a,error:o,isError:d,isLoading:u}=ze(t),s=a==null?void 0:a.data,{t:r}=D(),{token:c}=$(),[l,h]=C.useState(!1),p=async T=>{T.preventDefault();const y=new FormData(T.currentTarget);try{await Pe(t,y.get("description"),I.fromFormat(y.get("startDate"),"dd/MM/yyyy").toSQLDate(),I.fromFormat(y.get("endDate"),"dd/MM/yyyy").toSQLDate(),y.get("scope"),!!y.get("isPublic"),c,y.get("website")?y.get("website"):void 0,void 0,y.get("organizerId")?y.get("organizerId"):void 0),h(!1)}catch(L){n.show("Edit event failed. "+he.toString(L),{autoHideDuration:3e3,severity:"error"})}},v=()=>{h(!1)},b=()=>h(!0);if(u)return e(Ae,{});if(d){const T=(w=o.response)==null?void 0:w.status;return T==404?e(Ve,{}):T==403?e(xe,{severity:"error",variant:"outlined",sx:{margin:5},children:e(Me,{children:r("ForbiddenAccess")})}):e(Re,{})}else return g(oe,{children:[g(M,{sx:{marginY:"2em"},children:[e(x,{variant:"h3",children:r("EventAdmin.EventData")}),e(ue,{eventDetail:s,handleCancel:v,handleEdit:b,handleSubmit:T=>void p(T),canEdit:l})]}),g(M,{sx:{marginY:"2em"},children:[e(x,{variant:"h3",children:r("Stages")}),s?e(ct,{eventDetail:s}):e(S,{})]}),g(M,{sx:{marginY:"2em"},children:[e(x,{variant:"h3",children:r("EventAdmin.EventSecurityTokens")}),e(ht,{event_id:s?s.id:""})]}),g(M,{sx:{marginY:"12em"},children:[e(x,{variant:"h3",children:r("EventAdmin.DangerArea")}),s?e(gt,{event:s}):e(S,{})]})]})}export{Bt as default};
//# sourceMappingURL=EventAdmin-D58PcsVQ.js.map
