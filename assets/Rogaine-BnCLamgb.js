import{p as T,h as p,b as _,C as P,R as I,a as O,e as v,f as y,s as Q,c as V,S as N}from"./RacePosition.-DHoPjZjP.js";import{R as $,V as W,u as j,a as A,B as R,b as M}from"./RaceTime-DJoSClIQ.js";import{S as H,V as G,a as U,b as z,c as q,T as X}from"./VirtualTicketControl-B7ThI5Q8.js";import{R as J,P as B}from"./ParticipantName-CzcXrDcI.js";import{q as b,f as r,F as E,j as e,T as f,V as D,t as C,S as K,U as Y,v as Z,r as ee}from"./index-BLfwcZnC.js";import{G as h}from"./Grid-Cs3YhQyb.js";import{a as S}from"./Functions-DXipLJyb.js";import{T as te,a as se,b as ie,c as k,d as ne}from"./TableRow-XVadL1Mt.js";import{T as u}from"./TableCell-BjAr8kMi.js";import{a as ae}from"./hooks-DJkte6FL.js";import{a as F}from"./EventService-DtRxcSdU.js";import{u as w}from"./useQuery-DeaprV5y.js";import"./Skeleton-DUfcw-PJ.js";import"./Results-ncYOWpnQ.js";import"./constants-O1nRK1Hb.js";import"./NotFoundPage-fAyT2EpN.js";import"./styled-CBPC_bk9.js";import"./TextField--dGRmczi.js";import"./InputAdornment-Bjrq8b3k.js";import"./index-DDdbeMFW.js";import"./Tabs-sizw2E99.js";import"./KeyboardArrowRight-XBbj7KK7.js";import"./Trans-CRALoKKO.js";import"./Link-BkznJ8DK.js";import"./DialogTitle-BpV83U_V.js";try{let t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new t.Error().stack;s&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[s]="32180bbf-66d6-4f89-a646-6194f093b225",t._sentryDebugIdIdentifier="sentry-dbid-32180bbf-66d6-4f89-a646-6194f093b225")}catch{}const le=({runnerResult:t})=>{const{t:s}=b(),a={fontWeight:"bold",fontSize:"small"},n={display:"flex"},i={fontSize:"small",marginLeft:"6px"},l=T(t.status_code);return r(E,{children:[r(h,{style:n,item:!0,xs:4,children:[e(f,{style:a,children:s("ResultsStage.BonusPoints")}),e(f,{style:i,children:t.points_final||t.finish_time?`+${t.points_bonus}`:""})]}),r(h,{style:n,item:!0,xs:4,children:[e(f,{style:a,children:s("ResultsStage.PenaltyPoints")}),e(f,{style:i,children:t.points_final||t.finish_time?`${t.points_penalty}`:""})]}),r(h,{sx:{justifyContent:"flex-end"},style:n,item:!0,xs:4,children:[e(f,{style:a,children:s("ResultsStage.Points")}),e(f,{style:i,children:t.points_final||t.finish_time?`${t.points_final}`:""})]}),r(h,{style:n,item:!0,xs:6,children:[e(f,{style:a,children:s("ResultsStage.VirtualTicket.StartHour")}),e(H,{style:i,startTime:t.start_time})]}),r(h,{style:n,sx:{justifyContent:"flex-end"},item:!0,xs:6,children:[e(f,{style:a,children:s("ResultsStage.VirtualTicket.RaceTime")}),e($,{style:i,status:l,isFinalTime:p(t),start_time:t.start_time,finish_time:t.finish_time,time_seconds:t.time_seconds})]})]})},oe=({split:t,index:s})=>r(h,{style:{display:"flex",width:"100%",backgroundColor:s%2?"white":"#fcefde"},children:[e(G,{control:t.control,order_number:t.order_number,points:t.points,gridWidth:3}),e(h,{item:!0,xs:4,children:e(f,{sx:{textAlign:"center"},children:t.time!==null?S(t.time):"--"})}),e(h,{item:!0,xs:5,children:e(f,{sx:{textAlign:"center"},children:t.cumulative_time!==null?S(t.cumulative_time):"--"})})]}),re=({isTicketOpen:t,runner:s,handleCloseTicket:a,setClassClubId:n})=>{const{t:i}=b(),l={fontWeight:"bold",fontSize:"medium",textAlign:"center"};return s?r(W,{isTicketOpen:t,runner:s,handleCloseTicket:a,children:[r(U,{children:[e(z,{runner:s,setClassClubId:n}),e(le,{runnerResult:s.stage})]}),r(q,{download:p(s),isDNS:_.isDNS(s),children:[e(h,{item:!0,xs:3,children:e(f,{variant:"subtitle2",sx:l,children:i("ResultsStage.VirtualTicket.Control")})}),e(h,{item:!0,xs:4,children:e(f,{variant:"subtitle2",sx:l,children:i("ResultsStage.VirtualTicket.Partial")})}),e(h,{item:!0,xs:5,children:e(f,{variant:"subtitle2",sx:l,children:i("ResultsStage.VirtualTicket.Cumulative")})}),s.stage.splits.map((o,c)=>e(oe,{split:o,index:c},o.id))]})]}):e(E,{})};function ce(t){const{t:s}=b(),[a,n,i,l]=j(),o=t.runnersQuery.data?t.runnersQuery.data[0]:null;return t.activeItem?t.runnersQuery.isFetching||t.runnersQuery.isLoading?e(I,{}):t.runnersQuery.isError?e(D,{}):r(O,{children:[o==null?void 0:o.map(c=>{const d=c.stage,m=T(d==null?void 0:d.status_code),g=m===y.ok||m===y.nc,x=p(c);return r(J,{onClick:()=>i(c),children:[e(C,{sx:{flexShrink:0,display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-end",flexGrow:0,width:"10px"},children:e(v,{position:c.stage.position,isNC:c.is_nc||m===y.nc,hasDownload:x})}),e(B,{name:c.full_name,subtitle:t.isClass?_.getClubName(c,s):_.getClassName(c)}),r(C,{sx:{flexShrink:0,display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-end",flexGrow:1},children:[e(f,{children:g&&(d.points_final||d.finish_time)?`${d.points_final}`:""}),e($,{displayStatus:!0,status:m,isFinalTime:x,start_time:d.start_time,finish_time:d.finish_time,time_seconds:d.time_seconds})]})]},c.id)}),e(re,{isTicketOpen:a,runner:n,handleCloseTicket:l,setClassClubId:t.setClassClubId})]}):e(P,{})}function L(t){const s=new Set;return t.forEach(a=>{a.stage.splits.forEach(n=>{n.control&&s.add(BigInt(n.control.station))})}),Array.from(s).sort((a,n)=>a<n?-1:a>n?1:0)}const de=({number:t,punched:s=!1})=>e(C,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,borderRadius:"50%",borderColor:s?void 0:"text.secondary",border:s?0:1,backgroundColor:s?"secondary.main":void 0,color:s?"white":"text.secondary"},children:t.toString()});function ue(){const{t}=b();return e(K,{severity:"info",children:e(Y,{children:t("ResultsStage.PointsTable.OnlyForClasses")})})}function fe(t){const{t:s}=b(),a=t.runnersQuery.data?t.runnersQuery.data[0]:null,n=t.runnersQuery.data?t.runnersQuery.data[1]:null;return t.activeItem?t.isClass?t.runnersQuery.isFetching||t.runnersQuery.isLoading?e(I,{}):t.runnersQuery.isError?e(D,{}):e(te,{sx:{height:"100%",flex:1},children:r(se,{children:[e(ie,{children:r(k,{children:[e(u,{}),e(u,{sx:{fontWeight:"bold"},children:s("ResultsStage.Name")}),e(u,{sx:{fontWeight:"bold"},children:s("ResultsStage.BonusPoints")}),e(u,{sx:{fontWeight:"bold"},children:s("ResultsStage.PenaltyPoints")}),e(u,{sx:{fontWeight:"bold"},children:s("ResultsStage.Points")}),e(u,{sx:{fontWeight:"bold"},children:s("ResultsStage.RaceTime")}),n==null?void 0:n.map(i=>e(u,{},i))]},"table Head")}),e(ne,{children:a==null?void 0:a.map(i=>{const l=i.stage,o=T(l==null?void 0:l.status_code),c=o===y.ok||o===y.nc,d=L([i]);return r(k,{sx:{width:{md:"100%",sx:"200px"}},children:[e(u,{children:e(v,{position:i.stage.position,isNC:i.is_nc||o===y.nc,hasDownload:p(i)})},`runner${i.id}pos`),e(u,{sx:{minWidth:"200px"},children:e(B,{name:i.full_name,subtitle:_.getClubName(i,s)})},`runner${i.id}name`),e(u,{children:l.points_final||l.finish_time?`+${l.points_bonus}`:""},`runner${i.id}bonus`),e(u,{children:l.points_final||l.finish_time?`${l.points_penalty}`:""},`runner${i.id}penalty`),e(u,{children:l.points_final||l.finish_time?`${l.points_final}`:""},`runner${i.id}points`),e(u,{children:c?i.stage.finish_time!=null?S(i.stage.time_seconds):"-":s(`ResultsStage.statusCodes.${o}`)},`runner${i.id}time`),n==null?void 0:n.map(m=>e(u,{children:i.stage.points_final||i.stage.finish_time?e(de,{number:m,punched:d.includes(m)}):""},`runner${i.id}control${m}`))]},`runner${i.id}`)})})]})}):e(ue,{}):e(P,{})}async function me(t,s,a){let i=(await F(t,s,a,void 0)).data;i=Q(i);const l=V(i),o=L(l);return[l,o]}async function he(t,s,a){let i=(await F(t,s,void 0,a)).data;return i=Q(i),[V(i),[]]}const ge=["results","points"];function je(){const{t}=b(),{eventId:s,stageId:a}=Z();if(!s||!a)throw new Error("Event Id or Stage Id is missing");const{activeItem:n,classesQuery:i,clubsQuery:l,isClass:o,setClassClubId:c,refresh:d}=ae(),m=w([s,a,"results","classes",n==null?void 0:n.id],()=>n?me(s,a,n.id):[[],[]],{enabled:!!n&&o,refetchOnWindowFocus:!1}),g=w([s,a,"results","clubs",n==null?void 0:n.id],()=>n?he(s,a,n.id):[[],[]],{enabled:!!n&&!o,refetchOnWindowFocus:!1}),x=ee.useCallback(()=>{d(),o?m.refetch():g.refetch()},[d,m,g,o]);return e(N,{handleRefreshClick:x,activeItem:n,isClass:o,classesQuery:i,clubsQuery:l,setActiveClassClub:c,children:r(A,{defaultMenu:0,menuOptions:[e(R,{label:t("StageHeader.Results"),icon:e(M,{})},"rogaineRseultsMenu"),e(R,{label:t("StageHeader.ScorePoints"),icon:e(X,{})},"RogaineScorePointsMenu")],menuOptionsLabels:ge,children:[e(ce,{runnersQuery:o?m:g,activeItem:n,isClass:o,setClassClubId:c}),e(fe,{runnersQuery:o?m:g,activeItem:n,isClass:o})]})})}export{je as default};
//# sourceMappingURL=Rogaine-BnCLamgb.js.map
